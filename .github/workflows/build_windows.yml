name: Build Windows App

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v3

      # ШАГ 1: Используем createDistributable вместо packageDistribution
      # Это создаст обычную папку с EXE файлом, без попыток сделать MSI установщик
      - name: Create Exe Folder
        run: ./gradlew :composeApp:createDistributable

      # ШАГ 2 (Отладка): Если снова будет ошибка, мы увидим в логах, какие папки создались
      - name: List files (Debug)
        run: dir composeApp\build\compose\binaries /s

      # ШАГ 3: Загружаем результат
      - name: Upload Build Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Osync-Windows
          # Путь к папке, которую создает createDistributable
          path: composeApp/build/compose/binaries/main/app/Osync